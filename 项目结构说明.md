# 📁 项目结构说明

## 目录结构

```
node-openapi2mcp/
│
├── 📄 package.json              # Node.js 项目配置和依赖
├── 📄 README.md                 # 项目主文档（英文）
├── 📄 快速开始指南.md            # 快速入门指南（中文）
├── 📄 项目结构说明.md            # 本文件
├── 📄 CHANGELOG.md              # 版本更新日志
├── 📄 LICENSE                   # MIT 开源协议
│
├── 🐳 Dockerfile                # Docker 镜像构建配置
├── 🐳 docker-compose.yml        # Docker Compose 编排配置
├── 📝 .dockerignore             # Docker 构建忽略文件
├── 📝 .gitignore                # Git 版本控制忽略文件
│
├── 📂 src/                      # 后端源代码
│   └── server.js                # Node.js Express 服务器
│
├── 📂 public/                   # 前端静态资源
│   ├── index.html               # 主页面
│   ├── styles.css               # 样式表
│   └── app.js                   # 前端交互逻辑
│
├── 📂 scripts/                  # 辅助脚本
│   ├── start.sh                 # 本地启动脚本
│   ├── docker-build.sh          # Docker 构建脚本
│   └── install-go-tool.sh       # Go 工具安装脚本
│
├── 📂 examples/                 # 示例文件
│   └── petstore.json            # OpenAPI 示例文件
│
├── 📂 uploads/                  # 临时上传目录（运行时创建）
└── 📂 outputs/                  # 转换结果目录（运行时创建）
```

## 核心文件说明

### 后端服务（src/server.js）

Node.js + Express 服务器，提供以下功能：

- **文件上传处理**：使用 multer 处理文件上传
- **Go 命令封装**：执行 `openapi-to-mcp` 命令
- **API 接口**：
  - `POST /api/convert` - 转换接口
  - `GET /api/download/:filename` - 下载接口
  - `GET /api/health` - 健康检查接口
- **错误处理**：统一的错误处理中间件
- **临时文件管理**：自动清理上传的临时文件

### 前端页面（public/）

#### index.html
- 响应式布局
- 文件上传区域（支持拖拽）
- 参数配置表单
- 结果预览和下载

#### styles.css
- 现代化设计风格
- CSS 变量配置
- 渐变背景效果
- 响应式适配（移动端友好）
- 动画效果

#### app.js
- 文件拖拽上传
- 表单提交处理
- AJAX 请求封装
- 结果展示和下载
- 复制到剪贴板
- 错误提示和成功消息

### Docker 配置

#### Dockerfile（多阶段构建）

**阶段一：Go Builder**
- 基础镜像：`golang:1.21-alpine`
- 安装 `openapi-to-mcp` 工具
- 编译 Go 可执行文件

**阶段二：Runtime**
- 基础镜像：`node:20-alpine`
- 复制 Go 可执行文件
- 安装 Node.js 依赖
- 复制应用代码
- 暴露 3000 端口
- 配置健康检查

#### docker-compose.yml
- 服务定义：`openapi-to-mcp`
- 端口映射：`3000:3000`
- 环境变量配置
- 健康检查配置
- 重启策略

### 辅助脚本（scripts/）

#### start.sh
- 检查 Node.js 和 npm
- 检查 Go 和 openapi-to-mcp
- 安装依赖
- 创建必要目录
- 启动服务

#### docker-build.sh
- 构建 Docker 镜像
- 输出使用说明

#### install-go-tool.sh
- 检查 Go 环境
- 安装 `openapi-to-mcp` 工具
- 验证安装

## 数据流程

```
用户操作
   ↓
前端页面（HTML/CSS/JS）
   ↓ HTTP POST /api/convert
Node.js 后端（Express）
   ↓ 执行命令
Go 程序（openapi-to-mcp）
   ↓ 生成文件
MCP 配置文件（YAML/JSON）
   ↓ 返回
前端展示 + 下载
```

## 运行时目录

这些目录会在服务启动时自动创建：

- **uploads/** - 存储用户上传的临时文件
- **outputs/** - 存储转换生成的配置文件

## 环境要求

### Docker 运行
- Docker 19.03+
- Docker Compose 1.27+

### 本地运行
- Node.js 18+
- npm 9+
- Go 1.21+
- openapi-to-mcp 工具

## 端口使用

- **3000** - Web 服务主端口

可通过环境变量 `PORT` 自定义。

## 依赖包说明

### Node.js 依赖（package.json）

**生产依赖：**
- `express` - Web 框架
- `multer` - 文件上传处理
- `cors` - 跨域资源共享
- `js-yaml` - YAML 解析（未来功能预留）

**开发依赖：**
- `nodemon` - 开发热重载

### Go 依赖
- `github.com/higress-group/openapi-to-mcpserver/cmd/openapi-to-mcp` - OpenAPI 转 MCP 工具

## 安全考虑

1. **文件上传限制**：
   - 大小限制：10MB
   - 类型限制：仅 JSON/YAML
   
2. **临时文件清理**：
   - 处理后自动删除上传文件
   
3. **路径安全**：
   - 使用 path.join 防止路径遍历攻击
   
4. **错误处理**：
   - 统一错误处理中间件
   - 不暴露敏感信息

## 扩展建议

### 可添加功能

1. **用户认证**：添加 JWT 或 OAuth
2. **历史记录**：保存转换历史
3. **批量转换**：支持多文件上传
4. **在线编辑**：集成代码编辑器
5. **模板管理**：预设配置模板
6. **API 文档**：集成 Swagger UI

### 性能优化

1. **缓存机制**：对相同文件缓存结果
2. **队列处理**：使用 Redis 队列处理大量请求
3. **CDN 部署**：静态资源 CDN 加速
4. **负载均衡**：水平扩展多个实例

### 监控和日志

1. **应用监控**：集成 PM2 或 Prometheus
2. **日志管理**：使用 Winston 或 Pino
3. **错误追踪**：集成 Sentry
4. **性能分析**：添加性能指标采集

## 技术选型理由

### 为什么选择 Node.js？
- ✅ 轻量级，启动快速
- ✅ 异步 I/O，适合文件操作
- ✅ 生态丰富，依赖管理方便
- ✅ 与前端技术栈统一

### 为什么使用 Docker？
- ✅ 环境一致性（包含 Go 工具）
- ✅ 免安装部署
- ✅ 跨平台支持
- ✅ 易于扩展和维护

### 为什么采用多阶段构建？
- ✅ 减小镜像体积（无需完整 Go 工具链）
- ✅ 提高安全性（最小化攻击面）
- ✅ 加快部署速度

## 配置文件说明

### package.json
```json
{
  "scripts": {
    "start": "node src/server.js",      // 生产模式启动
    "dev": "nodemon src/server.js"      // 开发模式（热重载）
  }
}
```

### docker-compose.yml
```yaml
ports:
  - "3000:3000"     # 主机端口:容器端口
volumes:
  - ./outputs:/app/outputs  # 持久化输出文件
restart: unless-stopped     # 自动重启策略
```

## 故障诊断

### 日志位置
- **Docker**: `docker-compose logs -f`
- **本地**: 控制台输出

### 常见错误
1. **端口占用**：修改 PORT 环境变量
2. **Go 工具未找到**：检查 PATH 或重新安装
3. **文件权限**：确保 uploads/ 和 outputs/ 可写

---

**更新时间**: 2025-10-28
**维护者**: 项目团队

